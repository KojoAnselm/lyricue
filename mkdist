#!/bin/sh

VERSION=`head -1 debian/changelog |sed -e 's/^.*(\(.*\)).*$/\1/g'|sed -e 's/^.://g'`
LC_ALL=C;export LC_ALL

echo Removing old dist files
rm -rf dist/l*

echo Creating new files
mkdir dist
mkdir dist/lyricue-${VERSION}
cp -R * dist/lyricue-${VERSION}
rm -rf dist/dist
rm dist/lyricue-${VERSION}/mysql/MySQL_create_bible_NIV_us.sql
pushd dist/lyricue-${VERSION}
rm -rf dist
rm images/desktop.png images/*.svg
find . -name CVS -type d -exec rm -r \{} \; 2>/dev/null

echo Creating Debian packages
dpkg-buildpackage -rfakeroot
popd
rm -rf dist/lyricue-${VERSION}

echo Pushing to repository
cp dist/lyricue-cvs*deb dist/*.dsc dist/*.gz  /var/www/debian
cd /var/www/debian
dpkg-scanpackages . /dev/null | gzip -c > Packages.gz
dpkg-scansources . /dev/null | gzip -c > Sources.gz
